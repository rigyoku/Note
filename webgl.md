# three

## 官网
* https://threejs.org/
* 可以下载github工程然后本地启动服务来访问

## 打包
* parcel轻量打包工具, 相对于webpack零配置

## 场景
* 场景内包括要显示的物体, 和观察物体的相机, 光源, 模拟器等
* 可以设置背景贴图
* 为场景设置环境时, 相当于对场景内所有物体添加环境贴图



### 辅助器
* 可以添加例如光照辅助, 坐标辅助等辅助器到场景中

### 光照
* 自然光, 平行光等
* 可以设置光照起点

#### 阴影
* 平行光可以产生阴影
* 需要材质支持阴影
* 需要渲染器开启阴影计算
* 需要光源开启阴影
* 需要物体开启投影
* 需要底层物体接收投影

### 相机
* 可以设置相机的位置
* 可以设置相机的可视夹角, 相机画面的宽高比, 相机的近端和远端
* 设置轨道控制器可以移动相机

### 物体(网格)
* 物体由几何体+材质构成
* 几何体指定了形状, 材质指定了样式

#### 几何体
* 几何体的属性包括 normal[法向 3维] position[定点位置 3维] uv[纹理坐标 2维]
* 基于BufferGeometry, 可以通过创建Float32Array的数组来指定顶点来初始化
* three自带了大量几何体可以直接使用, 参考文档
* 顶点越多控制越细, 耗性能越大


#### 材质(纹理)
* 材质可以设置透明
* pbr基于物理渲染的标注材质, 需要添加灯光才能看见, 普通材质直接可见

##### 贴图
* 可以使用map添加贴图
* 贴图也可以进行移动, 旋转, 重复
* 贴图的自适应缩放可以指定方法, 例如就近或者插值缩放
* 可以通过加载器加载, 初始加载器可以指定管理器, 来统一管理该加载器加载的资源事件
* 可以去epic搞贴图, 也可以在 https://poliigon.com/ 下载

##### 环境遮挡
* 添加AO贴图(需要额外uv), 来额外添加遮挡, 使其颜色变暗[其他贴图也都是通过颜色来控制贴图效果的]
* 可以设置遮挡强度

##### 位移贴图
* 需要几何体有多个顶点来控制
* 用于贴图从平面突出一部分
* 也可以设置突出的长度

##### 粗糙贴图
* 用于控制反光效果的贴图
* 可以设置从漫反射到镜面反射的粗糙度

##### 金属贴图
* 控制贴图更像金属

##### 法线贴图
* 控制反光的方向

##### 环境贴图
* 物体反射的周围环境效果
* 通过cubetextureloader可以加载立方体贴图, 设置到envMap上, 就实现了该立方体场景包裹了该材质的物体, 物体如果反光就能看到周围效果

#### 操作
* 可以修改position移动[左是x增, 上是y增, z和css的zindex一致]
* 可以scale缩放, rotation旋转[使用PI计算角度]


## 渲染器
* 渲染场景用
* 需要指定要渲染的大小
* 将渲染内容(domElement)添加到页面中
* 执行渲染方法, 传入场景和相机

### 修改显示区大小
* 通过渲染器元素请求全屏, 通过document关闭全屏
* 动态修改大小时, 需要修改相机和渲染器2部分

### 动画

#### 请求帧动画
* 相比于setInterval性能更好, 浏览器不可见时不执行
* 回调参数为执行了多少毫秒

#### clock
* 自带的时钟计时, 也可以控制帧

#### gsap补间动画
* 通过该包去操作动画更方便
* 可以指定移动的属性, 用时, 是否重复, 重复过程是否倒回(yoyo), 暂停和恢复动画方法

## 调试工具
* dat.gui包, 可以在屏幕右上出现控制器
* 可以add添加要控制的属性, 还可以添加folder使用层级管理

## 补充知识

### hdr
* 高动态范围成像. 使用多曝光来获取多张图片后融合, 使其获得更多细节
* 可以使用datatextureloader加载
* 直接使用是图片, 需要修改纹理的映射为经纬线映射贴图

### 导入blender
* 导入glb文件
* 模型镜像修改器不应用会只有一半
* 粒子效果未出现
* 坐标轴向不一致

# blender
* 开源3d建模软件
* blender.org
* 建议修改撤销次数[编辑->偏好设置->系统], 增加撤销的机会
* 游标指定用于添加物体到哪[shift+右键定位]
* /键 隔离模式 只操作选中物体
* 编辑模式可以编辑点线面[tab]
    * 衰减: G查看衰减圈, 滚轮控制大小, 可以让球凹进去
* 模型建好之后最后进行分组[集合]
* 实体着色方式直接可见, 渲染方式需要光
* 可以更改渲染引擎和计算在cpu/gpu
* s + 数字 可以直接倍数放大
* 网格->吸附->游标.选中项 可以吸附到中心[shift+s](注意是游标到选中项, 而不是选中项到游标, 不然会反向吸附...)
* 右键一个功能, 可以指定快捷键, 或者添加到快速收藏夹[q]
* 关联复制之后, 修改一起, 其他也会变更
* alt+z 开启透视视图

## 修改器属性
* 可以进行倒角[圆角]操作
    * 倒角修改轮廓类型为自定义, 指定阶梯, 可以实现楼梯效果, 可以修改阶梯数
    * 几何数据 外衔接修改成圆弧, 会更自然
    * 倒角大了会出现重叠部分, 开启钳制重叠可以取消重叠效果
        * 重叠的点, 可以全选后m键合并, 按距离合并即可
* 添加表面细分, 让其更光滑
    * 可能导致配色偏移, 可以额外添加环切线处理
* 修改器也可以进行关联
* 阵列修改器, 可以实现复制

## 编辑模型
* 可以进行挤出, 配合快捷键指定z轴
* 选中面, i添加内插面
* 选中边进行倒角, 配合滚轮拉动控制角数
* alt选中循环边后, 桥接循环边可以掏空圈柱后添加内部面
* 环切可以增加额外的线圈来操作
* 可以加循环边, 然后一层的倒角, 然后选择循环面, 沿着法向挤出

## 相机
* ~进入摄像机视图, 开启选项[快捷键n], 视图, 锁定摄像机视图后, 可以滚轮控制视野
* 右键边栏, 垂直分割, 开启一个区域来单独显示摄像机效果
* 右侧打印机图标, 可以控制摄像机出图的设置
* 点击渲染, 渲染图像, 即可查看效果
* ctrl+alt+0 可以快捷指定摄影机到当前视角

## 材质
* 界面->编辑器->拾色器类型, 可以修改成方的, 默认是圆的
* 选中多个物体后 ctrl+l 进行材质关联, 可以直接复制材质[最后选有材质的物体]

## 世界颜色
* 会对场景产生影响

## 动画
* 就是记录不同时间的属性变化
* 动画属性[锁头后面的小圆点], 点击变菱形, 在时间线变更时点击菱形保存关键帧
* 通过选中物体, 快捷键i来插入关键帧来记录位置
* 旋转可以做一个大几何体作为父元素, 然后旋转几何体
* 选项->仅影响->原点, 可以调整动画缩放中心
* 线的生长动画: 曲线->开始结束映射, 修改开始/结束帧的0/1
* 除了直接导出mp4, 还可以导出png帧列, 这样好处是可以从崩溃处重新生成
    * 顶部加号->视频编辑->视频编辑, 添加->图像/序列, a全选
    * 音频需要额外选一下音频编码器
    * 如果视频编辑里放入了序列帧, 那么再渲染就是黑屏的, 先删了

## 文本
* 添加之后直接进入编辑模型[tab]进行修改
* 设置原点到几何中心调整更方便
* 添加实体化修改器, 可以增加厚度

## 曲线
* 编辑模式a全选后 s x[方向, 可能是y] 0 可以变直线
* 细分可以添加额外点来弯曲
* 曲线的物体属性数据->几何数据->倒角, 可以添加曲线的厚度, 封盖可以闭合边缘
* 曲线无法操作布线, 可以转成网格再操作

## 借型
* 选中边, 然后shift+d复制, 然后p分离, 然后从边创建面, 可以创建面, 之后挤出图形
* 选中起点, ctrl选中终点, 会寻找最短的线, 复制分离后, 点击物体然后转换成曲线
    * 扁的需要应用缩放

## 插件
* 编辑->插件->搜bool然后打勾
* n 编辑 就可以看到布尔运算, 可以打洞
    * 上面是不显示边界范围, 底下是显示边界范围
    * 显示为实体/边界范围可以控制是否显示

## 选择
* 可以间隔式弃选
* ctrl + 小键盘+-号 进行扩展选择

## 粒子
* 粒子可以发射物体, 或者立出毛发模型
* 可以发射/生成出物体或者集合
* 可以通过重力和速度控制发射体的运动
* 随机种控制随机结果
* 布朗效果就是随机方向
* 毛发的材质直接修改发射面即可

## 雕刻
* 模型的雕刻精细度依赖于布线
* f调节半径大小
* ctrl反向操作, 即 添加/扣除
* shift平滑
* 弹性变形拉形状
* 蛇形钩子可以拉触角
* 重构网格可以去掉顶部极点
    * 重构网格可以设置体素大小, 就是单元格大小

## 刚体
* 刚体类型被动就是放在那不动的物体
* 有凹陷时, 碰撞类型要改成网格